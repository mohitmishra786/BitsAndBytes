#include <stdio.h>
#include <string.h>

void print_registers() {
    unsigned int eax, ebx, ecx, edx, esi, edi, ebp, esp;
    
    asm volatile(
        "movl %%eax, %0\n"
        "movl %%ebx, %1\n"
        "movl %%ecx, %2\n"
        "movl %%edx, %3\n"
        "movl %%esi, %4\n"
        "movl %%edi, %5\n"
        "movl %%ebp, %6\n"
        "movl %%esp, %7\n"
        : "=r"(eax), "=r"(ebx), "=r"(ecx), "=r"(edx),
          "=r"(esi), "=r"(edi), "=r"(ebp), "=r"(esp)
    );
    
    printf("Register Values:\n");
    printf("EAX: 0x%08x\n", eax);
    printf("EBX: 0x%08x\n", ebx);
    printf("ECX: 0x%08x\n", ecx);
    printf("EDX: 0x%08x\n", edx);
    printf("ESI: 0x%08x\n", esi);
    printf("EDI: 0x%08x\n", edi);
    printf("EBP: 0x%08x\n", ebp);
    printf("ESP: 0x%08x\n", esp);
}

void vulnerable_function(const char* input) {
    char buffer[20];
    
    printf("\nBefore buffer operation:\n");
    print_registers();
    
    strcpy(buffer, input);
    
    printf("\nAfter buffer operation:\n");
    print_registers();
}

int main(int argc, char* argv[]) {
    if (argc != 2) {
        printf("Usage: %s <input_string>\n", argv[0]);
        return 1;
    }
    
    vulnerable_function(argv[1]);
    return 0;
}